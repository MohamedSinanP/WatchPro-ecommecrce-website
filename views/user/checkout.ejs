<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/css/User/checkout.css">
  <!--===============================================================================================-->
  <link rel="icon" type="image/png" href="/css/User/images/icons/favicon.png" />
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/bootstrap/css/bootstrap.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/fonts/iconic/css/material-design-iconic-font.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/fonts/linearicons-v1.0.0/icon-font.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/animate/animate.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/css-hamburgers/hamburgers.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/animsition/css/animsition.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/select2/select2.min.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/daterangepicker/daterangepicker.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/slick/slick.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/MagnificPopup/magnific-popup.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/vendor/perfect-scrollbar/perfect-scrollbar.css">
  <!--===============================================================================================-->
  <link rel="stylesheet" type="text/css" href="/css/User/css/util.css">
  <link rel="stylesheet" type="text/css" href="/css/User/css/main.css">
</head>

<body>

  <!-- Header -->
  <%- include('../partials/user/header') %>

    <!-- Checkout Header -->
    <div class="checkout-header">
      <div class="container">
        <div class="header-content">
          <h1><i class="fas fa-shopping-cart"></i> Secure Checkout</h1>
          <p class="header-subtitle">Complete your purchase safely and securely</p>
        </div>
      </div>
    </div>

    <div class="checkout-wrapper">
      <div class="container">
        <div class="checkout-container">

          <!-- Progress Indicator -->
          <div class="progress-indicator">
            <div class="progress-step active">
              <div class="step-number">1</div>
              <span class="step-label">Shipping</span>
            </div>
            <div class="progress-line"></div>
            <div class="progress-step">
              <div class="step-number">2</div>
              <span class="step-label">Payment</span>
            </div>
            <div class="progress-line"></div>
            <div class="progress-step">
              <div class="step-number">3</div>
              <span class="step-label">Confirmation</span>
            </div>
          </div>

          <div class="checkout-content">

            <!-- Shipping Information Section -->
            <div class="shipping-section">
              <div class="section-title">
                <i class="fas fa-truck"></i>
                <span>Shipping Information</span>
              </div>

              <!-- Saved Addresses Section -->
              <div class="saved-addresses">
                <h4 class="subsection-title">Choose a Delivery Address</h4>
                <div class="address-scroll">
                  <% addresses.forEach(address=> { %>
                    <div class="address-card" data-address-id="<%= address._id %>">
                      <div class="address-name">
                        <%= address.firstName %>
                          <%= address.lastName %>
                      </div>
                      <div class="address-details">
                        <p>
                          <%= address.address %>
                        </p>
                        <p>
                          <%= address.city %>, <%= address.state %> - <%= address.pincode %>
                        </p>
                        <p><i class="fas fa-phone"></i>
                          <%= address.phoneNumber %>
                        </p>
                      </div>
                      <button class="select-address-btn" onclick="selectAddress('<%= address._id %>')">
                        <i class="fas fa-check"></i> Select Address
                      </button>
                    </div>
                    <% }) %>
                </div>
              </div>

              <div class="divider"></div>

              <!-- New Address Form -->
              <div class="new-address-section">
                <h4 class="subsection-title">
                  <i class="fas fa-plus-circle"></i>
                  Add New Address
                </h4>

                <form id="addAddressForm" class="address-form">
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="firstName" class="form-label">First Name *</label>
                      <input type="text" class="form-control" id="firstName" name="firstName"
                        placeholder="Enter first name">
                      <div class="invalid-feedback">First Name is required.</div>
                    </div>
                    <div class="form-group">
                      <label for="lastName" class="form-label">Last Name *</label>
                      <input type="text" class="form-control" id="lastName" name="lastName"
                        placeholder="Enter last name">
                      <div class="invalid-feedback">Last Name is required.</div>
                    </div>
                  </div>

                  <div class="form-group full-width">
                    <label for="address" class="form-label">Street Address *</label>
                    <textarea class="form-control" id="address" name="address" placeholder="Enter your full address"
                      rows="3"></textarea>
                    <div class="invalid-feedback">Address is required.</div>
                  </div>

                  <div class="form-grid">
                    <div class="form-group">
                      <label for="phoneNumber" class="form-label">Phone Number *</label>
                      <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber"
                        placeholder="Enter phone number">
                      <div class="invalid-feedback">Phone Number is required.</div>
                    </div>
                    <div class="form-group">
                      <label for="city" class="form-label">City *</label>
                      <input type="text" class="form-control" id="city" name="city" placeholder="Enter city">
                      <div class="invalid-feedback">City is required.</div>
                    </div>
                  </div>

                  <div class="form-grid">
                    <div class="form-group">
                      <label for="state" class="form-label">State *</label>
                      <select class="form-control" id="state" name="state">
                        <option value="">Choose state</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                        <option value="Assam">Assam</option>
                        <option value="Bihar">Bihar</option>
                        <!-- Add other states here -->
                      </select>
                      <div class="invalid-feedback">State is required.</div>
                    </div>
                    <div class="form-group">
                      <label for="pincode" class="form-label">Pincode *</label>
                      <input type="number" class="form-control" id="pincode" name="pincode" placeholder="Enter pincode">
                      <div class="invalid-feedback">Pincode is required.</div>
                    </div>
                  </div>

                  <button type="submit" class="add-address-btn">
                    <i class="fas fa-plus"></i>
                    Add New Address
                  </button>
                </form>
              </div>
            </div>

            <!-- Order Summary Section -->
            <div class="order-summary">
              <div class="section-title">
                <i class="fas fa-receipt"></i>
                <span>Order Summary</span>
              </div>

              <!-- Cart Items -->
              <div class="order-items">
                <% cartItems.products.forEach(item=> { %>
                  <div class="order-item">
                    <div class="item-details">
                      <div class="item-name">
                        <%= item.name %>
                      </div>
                      <div class="item-quantity">Qty: <%= item.quantity %>
                      </div>
                    </div>
                    <div class="item-price">$<%= (item.price * item.quantity).toFixed(2) %>
                    </div>
                  </div>
                  <% }) %>
              </div>

              <!-- Price Summary -->
              <div class="summary-section">
                <div class="summary-title">
                  <i class="fas fa-calculator"></i>
                  Payment Details
                </div>
                <div class="summary-row">
                  <span>Subtotal:</span>
                  <span>
                    <%= cartTotal %>
                  </span>
                </div>
                <div class="summary-row">
                  <span>Shipping:</span>
                  <span>
                    <%= shippingCharge %>
                  </span>
                </div>
                <div class="summary-total">
                  <span>Total:</span>
                  <span>
                    <%= total %>
                  </span>
                </div>
              </div>

              <!-- Payment Options -->
              <div class="payment-section">
                <div class="subsection-title">
                  <i class="fas fa-credit-card"></i>
                  Payment Method
                </div>

                <div class="payment-option">
                  <input class="payment-radio" type="radio" name="paymentMethod" id="cashOnDelivery" value="COD">
                  <label class="payment-label" for="cashOnDelivery">
                    <i class="payment-icon fas fa-money-bill-wave"></i>
                    <div class="payment-info">
                      <div class="payment-name">Cash on Delivery</div>
                      <div class="payment-desc">Pay when you receive your order</div>
                    </div>
                  </label>
                </div>

                <div class="payment-option">
                  <input class="payment-radio" type="radio" name="paymentMethod" id="razorpay" value="Razorpay">
                  <label class="payment-label" for="razorpay">
                    <i class="payment-icon fab fa-cc-visa"></i>
                    <div class="payment-info">
                      <div class="payment-name">Razorpay</div>
                      <div class="payment-desc">Credit/Debit Card, UPI, Net Banking</div>
                    </div>
                  </label>
                </div>

                <div class="payment-option">
                  <input class="payment-radio" type="radio" name="paymentMethod" id="wallet" value="Wallet">
                  <label class="payment-label" for="wallet">
                    <i class="payment-icon fas fa-wallet"></i>
                    <div class="payment-info">
                      <div class="payment-name">Digital Wallet</div>
                      <div class="payment-desc">Pay using your wallet balance</div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Place Order Button -->
              <button class="place-order-btn">
                <i class="fas fa-lock"></i>
                Place Order Securely
              </button>

              <!-- Security Badge -->
              <div class="security-badge">
                <i class="fas fa-shield-alt"></i>
                <span>Your payment information is secure and encrypted</span>
              </div>

              <!-- Hidden elements to store data for JavaScript -->
              <p class="hidden" id="totalDiscount" style="display: none;">
                <%= totalDiscount %>
              </p>
              <p class="hidden" id="couponId" style="display: none;">
                <%= couponId %>
              </p>
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- footer-->
    <%- include('../partials/user/footer') %>

      <!-- Scripts -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
      <script src="/css/User/vendor/jquery/jquery-3.2.1.min.js"></script>
      <script src="/css/User/vendor/animsition/js/animsition.min.js"></script>
      <script src="/css/User/vendor/bootstrap/js/popper.js"></script>
      <script src="/css/User/vendor/bootstrap/js/bootstrap.min.js"></script>
      <script src="/css/User/vendor/select2/select2.min.js"></script>
      <script src="/css/User/vendor/daterangepicker/moment.min.js"></script>
      <script src="/css/User/vendor/daterangepicker/daterangepicker.js"></script>
      <script src="/css/User/vendor/slick/slick.min.js"></script>
      <script src="/css/User/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
      <script src="/css/User/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
      <script src="/css/User/js/main.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

      <!-- Your external JavaScript file -->
      <script src="/js/user/checkout.js"></script>

</body>

</html>